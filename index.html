<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 ì„±ê³¼ê¸‰ í”„ë¡œì íŠ¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: { extend: {} }
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body { font-family: 'Pretendard', sans-serif; transition: background-color 0.3s, color 0.3s; }
        .card { border-radius: 12px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); transition: all 0.3s; }
        .custom-scroll::-webkit-scrollbar { height: 8px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; margin: 0 10px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .dark .custom-scroll::-webkit-scrollbar-thumb { background: #475569; }
        input, select, textarea { border-width: 1px; border-radius: 6px; padding: 6px 8px; font-size: 0.9rem; transition: all 0.2s; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: #3b82f6; }
        input[type="number"] { text-align: right; }
        input:read-only { background-color: #f3f4f6; color: #6b7280; cursor: not-allowed; }
        .dark input:read-only { background-color: #374151; color: #9ca3af; }
        .tab-btn { padding: 8px 16px; font-weight: bold; border-radius: 9999px; transition: all 0.2s; white-space: nowrap; }
        .month-card.done { border: 2px solid #3b82f6; }
        html:not(.dark) .month-card.done { background-color: #eff6ff; }
        html.dark .month-card.done { background-color: #1e3a8a; border-color: #60a5fa; }
        .text-up { color: #ef4444; } .text-down { color: #3b82f6; }
        html.dark .text-up { color: #f87171; } html.dark .text-down { color: #60a5fa; }
        .bg-up-light { background-color: #fef2f2; } .bg-down-light { background-color: #eff6ff; }
        html.dark .bg-up-light { background-color: rgba(239, 68, 68, 0.1); } html.dark .bg-down-light { background-color: rgba(59, 130, 246, 0.1); }
        th.sortable { cursor: pointer; user-select: none; transition: background 0.2s; }
        th.sortable:hover { background-color: rgba(0,0,0,0.05); }
        .dark th.sortable:hover { background-color: rgba(255,255,255,0.1); }
        .milestone-marker { position: absolute; bottom: 100%; transform: translateX(-50%); display: flex; flex-direction: column; align-items: center; transition: all 0.5s; }
        .milestone-flag { font-size: 10px; margin-bottom: 2px; transition: all 0.5s; }
        .milestone-line { width: 1px; height: 6px; background-color: rgba(255,255,255,0.5); }
        .milestone-achieved .milestone-flag { transform: scale(1.5); text-shadow: 0 0 10px yellow; }
        @keyframes levelUp { 0% { transform: scale(1); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }
        .level-up-anim { animation: levelUp 0.5s ease-in-out; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        .pet-anim { animation: bounce 2s infinite ease-in-out; cursor: pointer; }
    </style>
</head>
<body class="text-gray-800 bg-gray-100 dark:bg-gray-900 dark:text-gray-100 pb-20">

    <nav class="bg-blue-600 dark:bg-gray-800 text-white p-4 shadow-lg sticky top-0 z-50 transition-colors duration-300">
        <div class="max-w-6xl mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="flex items-center justify-between w-full md:w-auto">
                <div class="flex items-center gap-2">
                    <h1 class="text-xl font-bold">ğŸš€ 2026 ì„±ê³¼ê¸‰ í”„ë¡œì íŠ¸</h1>
                    <span class="text-xs bg-blue-500 dark:bg-gray-700 px-2 py-1 rounded font-mono">Ver 30.0</span>
                </div>
                <button onclick="toggleTheme()" class="md:hidden p-2 rounded-full hover:bg-white/10 text-xl"><span id="theme-icon-m">ğŸŒ™</span></button>
            </div>
            <div class="flex items-center gap-3 w-full md:w-auto justify-center">
                <div class="flex bg-blue-800 dark:bg-gray-700 bg-opacity-30 p-1 rounded-full overflow-x-auto max-w-full custom-scroll">
                    <button onclick="switchPage('main')" id="tab-main" class="tab-btn active text-sm">ğŸ“Š 1ìª½: ë©”ì¸</button>
                    <button onclick="switchPage('pre')" id="tab-pre" class="tab-btn inactive text-sm">ğŸŒ± 2ìª½: ì¤€ë¹„</button>
                    <button onclick="switchPage('journal')" id="tab-journal" class="tab-btn inactive text-sm">ğŸ“ˆ 3ìª½: íˆ¬ì</button>
                    <button onclick="switchPage('future')" id="tab-future" class="tab-btn inactive text-sm">ğŸ”® 4ìª½: ë¯¸ë˜</button>
                </div>
                <button onclick="toggleTheme()" class="hidden md:block p-2 rounded-full hover:bg-white/10 text-xl"><span id="theme-icon-pc">ğŸŒ™</span></button>
            </div>
        </div>
    </nav>

    <!-- [PAGE 1] ë©”ì¸ (ìœ ì§€) -->
    <div id="page-main" class="max-w-6xl mx-auto p-4 space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="card bg-gradient-to-br from-blue-700 to-blue-500 dark:from-blue-900 dark:to-blue-800 text-white border-none shadow-xl relative overflow-hidden">
                <div class="absolute top-0 right-0 -mt-4 -mr-4 w-24 h-24 bg-white opacity-10 rounded-full"></div>
                <div class="absolute top-4 right-4 flex flex-col items-end">
                    <span id="level-badge" class="bg-white/20 px-3 py-1 rounded-full text-xs font-bold backdrop-blur-sm border border-white/30">ğŸŒ± ì”¨ì•—</span>
                    <span id="next-level-gap" class="text-[10px] text-blue-100 mt-1">ë‹¤ìŒ ë ˆë²¨ê¹Œì§€ 500ë§Œ</span>
                </div>
                <div class="flex justify-between items-start mb-2"><p class="text-blue-100 text-sm font-medium">ğŸ’° í˜„ì¬ ì´ ìì‚° (ì‹œë“œ+ì €ì¶•)</p><span class="text-xs bg-blue-800 bg-opacity-30 px-2 py-1 rounded">Net Worth</span></div>
                <h2 class="text-3xl font-bold tracking-tight" id="totalAsset">0ì›</h2>
                
                <div class="mt-4 bg-black bg-opacity-20 rounded-lg p-3 text-sm space-y-2">
                    <div class="flex justify-between items-center"><span class="text-blue-200 text-xs">ğŸ ëª©í‘œ ê¸°í•œ</span><div class="flex items-center gap-2"><span id="d-day-badge" class="hidden bg-yellow-400 text-blue-900 text-[10px] font-bold px-1.5 py-0.5 rounded">D-day</span><input type="month" id="target-deadline" onchange="calculateTotalAndChart()" class="bg-white bg-opacity-20 border-none text-white text-xs p-1 rounded focus:ring-1 focus:ring-white"></div></div>
                    <div class="flex justify-between items-center border-t border-blue-400 border-opacity-30 pt-2"><span class="text-blue-100">ğŸ“… ì˜ˆìƒ ë‹¬ì„±ì¼</span><div class="text-right"><div class="font-bold text-white" id="prediction-date">ê³„ì‚° ì¤‘...</div><div class="text-xs" id="prediction-diff"></div></div></div>
                </div>

                <div class="mt-6">
                    <div class="flex justify-between items-center text-xs text-blue-100 mb-1"><div class="flex items-center gap-1"><span>ğŸ¯ ëª©í‘œ:</span><input type="number" id="target-goal" value="2400" oninput="calculateTotalAndChart()" class="w-16 bg-blue-800 bg-opacity-40 border-none text-white text-right font-bold p-0.5 rounded focus:ring-1 focus:ring-white"><span>ë§Œì›</span></div><span id="progress-text" class="font-bold">0%</span></div>
                    <div class="relative w-full h-4 mt-2 mb-2"><div class="w-full bg-blue-900 bg-opacity-30 h-1.5 rounded-full overflow-hidden absolute bottom-0"><div id="progress-bar" class="bg-white h-full rounded-full transition-all duration-500" style="width: 0%"></div></div><div id="milestones-container" class="absolute top-0 w-full h-full pointer-events-none"></div></div>
                </div>
            </div>
            
            <div class="card bg-gradient-to-br from-emerald-600 to-emerald-400 dark:from-emerald-800 dark:to-emerald-700 text-white border-none shadow-xl relative overflow-hidden">
                <div class="absolute top-0 right-0 -mt-4 -mr-4 w-24 h-24 bg-white opacity-10 rounded-full"></div>
                <div class="flex justify-between items-start mb-2"><p class="text-emerald-100 text-sm font-medium">ğŸ’µ í”„ë¡œì íŠ¸ ì´ ìˆ˜ì…</p><span class="text-xs bg-emerald-800 bg-opacity-30 px-2 py-1 rounded">Income</span></div>
                <h2 class="text-3xl font-bold tracking-tight" id="totalIncomeDisplay">0ì›</h2>
                <div class="mt-4 flex items-center text-xs text-emerald-100 opacity-90"><span class="mr-1">â„¹ï¸</span><span>ì›”ê¸‰ê³¼ ëª¨ë“  ìˆ˜ë‹¹ì´ í•©ì‚°ëœ ê¸ˆì•¡ì…ë‹ˆë‹¤.</span></div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            <div class="lg:col-span-7 space-y-4">
                <div class="flex justify-between items-center px-1"><h3 class="text-lg font-bold flex items-center">ğŸ“… ì›”ë³„ ê¸°ë¡ì¥ <span id="current-month-display" class="ml-2 text-blue-600 dark:text-blue-400 text-base"></span></h3><button onclick="toggleSettings()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 text-sm flex items-center gap-1 border border-gray-300 dark:border-gray-600 rounded px-2 py-1 bg-white dark:bg-gray-800">âš™ï¸ í•­ëª© ê´€ë¦¬</button></div>
                <div id="settings-panel" class="hidden card border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-800 mb-4"><h4 class="font-bold text-sm mb-3 dark:text-gray-200">ğŸ› ï¸ íˆ¬ì í•­ëª© ì„¤ì •</h4><div class="flex gap-2 mb-4"><input type="text" id="new-item-name" placeholder="ìƒˆ í•­ëª© ì´ë¦„" class="flex-1 p-2 border rounded text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white"><input type="color" id="new-item-color" value="#3b82f6" class="h-9 w-9 p-0 border rounded cursor-pointer dark:bg-gray-700 dark:border-gray-600"><button onclick="addNewField()" class="bg-blue-600 text-white px-3 py-1 rounded text-sm font-bold">ì¶”ê°€</button></div><ul id="field-list" class="space-y-2 text-sm"></ul></div>
                <div class="bg-gray-100 dark:bg-gray-800 p-2 rounded-xl shadow-inner"><div id="month-nav" class="flex space-x-2 overflow-x-auto custom-scroll pb-2 select-none"></div></div>
                <div id="monthly-container"></div>
                <div id="income-container"></div>
                <div class="card bg-white dark:bg-gray-800 mt-4"><h3 class="text-sm font-bold mb-2 text-gray-500 dark:text-gray-400">ğŸ“ íˆ¬ì ë©”ëª¨</h3><textarea id="memoArea" class="w-full h-20 border rounded p-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none resize-none dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="ììœ ë¡­ê²Œ ë©”ëª¨í•˜ì„¸ìš”. (ìë™ ì €ì¥)"></textarea></div>
            </div>
            <div class="lg:col-span-5 space-y-6">
                <div class="card bg-white dark:bg-gray-800 border-l-4 border-indigo-500">
                    <div class="flex justify-between items-center mb-3"><h3 class="text-sm font-bold text-indigo-900 dark:text-indigo-200">ğŸ¦ ê¸°ì¡´ ìì‚° (ìƒì„¸ ì…ë ¥)</h3><span class="text-xs text-indigo-400 dark:text-indigo-300 font-normal">ë‹¨ìœ„: ë§Œì›</span></div>
                    <div class="mb-3"><p class="text-xs font-bold text-gray-500 dark:text-gray-400 mb-1">ğŸ›¡ï¸ ì•ˆì „ ìì‚° (ì˜ˆì ê¸ˆ)</p><div class="grid grid-cols-3 gap-2"><input type="number" id="seed-deposit" oninput="saveSeedData()" placeholder="ì˜ˆê¸ˆ" class="text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white"><input type="number" id="seed-savings" oninput="saveSeedData()" placeholder="ì ê¸ˆ" class="text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white"><input type="number" id="seed-house" oninput="saveSeedData()" placeholder="ì²­ì•½" class="text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white"></div></div>
                    <div><p class="text-xs font-bold text-gray-500 dark:text-gray-400 mb-1">ğŸ“ˆ íˆ¬ì ìì‚°</p><div class="grid grid-cols-2 gap-2"><div class="relative"><input type="number" id="seed-stock" readonly class="w-full text-sm font-bold text-blue-600 dark:text-blue-400"><span class="absolute right-1 top-1/2 -translate-y-1/2 text-[10px] text-gray-400 pointer-events-none">3ìª½ì—°ë™</span></div><input type="number" id="seed-bond" oninput="saveSeedData()" placeholder="ì±„ê¶Œ/ê¸°íƒ€" class="text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white"></div></div>
                    <div class="mt-3 pt-2 border-t dark:border-gray-700 flex justify-between items-center"><span class="text-xs text-gray-500 dark:text-gray-400">ê¸°ì¡´ ìì‚° í•©ê³„</span><span class="font-bold text-indigo-600 dark:text-indigo-300" id="seed-total-display">0ë§Œì›</span></div>
                </div>
                <div class="card bg-white dark:bg-gray-800"><h3 class="text-lg font-bold mb-4 border-b dark:border-gray-700 pb-2">ğŸ“ˆ ìì‚° ì„±ì¥ ì¶”ì´</h3><div class="h-48 flex justify-center items-center"><canvas id="growthChart"></canvas></div></div>
                <div class="card bg-white dark:bg-gray-800 relative"><h3 class="text-lg font-bold mb-4 border-b dark:border-gray-700 pb-2">ğŸ’° ì´ë²ˆ í”„ë¡œì íŠ¸ ì €ì¶•ë¥ </h3><div class="h-48 flex justify-center items-center relative"><canvas id="mainSavingsChart"></canvas><div class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none"><span class="text-xs text-gray-400">ì €ì¶•ë¥ </span><span class="text-2xl font-bold text-blue-600 dark:text-blue-400" id="mainSavingsText">0%</span></div></div></div>
                <div class="card bg-white dark:bg-gray-800"><h3 class="text-lg font-bold mb-4 border-b dark:border-gray-700 pb-2">ğŸ“Š ì‹ ê·œ íˆ¬ì í¬íŠ¸í´ë¦¬ì˜¤</h3><div class="h-48 flex justify-center items-center"><canvas id="portfolioChart"></canvas></div></div>
                <div class="card bg-white dark:bg-gray-800"><div class="flex justify-between items-center mb-4 border-b dark:border-gray-700 pb-2"><h3 class="text-lg font-bold">ğŸ›’ ìƒí™œë¹„ ì§€ì¶œ</h3><span class="text-xs bg-red-100 dark:bg-red-900 text-red-600 dark:text-red-300 px-2 py-1 rounded-full font-bold">ì˜ˆì‚°: 15~20ë§Œ</span></div><div class="grid grid-cols-2 gap-2 mb-4"><div class="bg-gray-50 dark:bg-gray-700 p-2 rounded text-center"><p class="text-xs text-gray-500 dark:text-gray-400">ì´ ì§€ì¶œ</p><p class="font-bold text-gray-700 dark:text-gray-200" id="totalExpense">0ì›</p></div><div class="bg-gray-50 dark:bg-gray-700 p-2 rounded text-center"><p class="text-xs text-gray-500 dark:text-gray-400">ì›” í‰ê· </p><p class="font-bold text-gray-700 dark:text-gray-200" id="avgExpense">0ì›</p></div></div><div class="space-y-2 max-h-80 overflow-y-auto pr-1 custom-scroll" id="expense-container"></div></div>
            </div>
        </div>
    </div>

    <!-- [PAGE 2] ì¤€ë¹„ (ìœ ì§€) -->
    <div id="page-pre" class="max-w-6xl mx-auto p-4 space-y-6 hidden">
        <div class="card bg-indigo-600 dark:bg-indigo-800 text-white border-none shadow-xl"><h2 class="text-2xl font-bold">ğŸŒ± í”„ë¡œì íŠ¸ ì¤€ë¹„ ê¸°ê°„ (í”„ë¦¬ ì‹œì¦Œ)</h2><p class="text-indigo-100 text-sm mt-1">ë³¸ê²© ì‹œì‘ ì „, ì¢…ì£ëˆ í™•ë³´ ë° ì§€ì¶œ êµ¬ì¡°ì¡°ì •</p></div>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4" id="pre-container"></div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="card bg-indigo-50 dark:bg-indigo-900 border border-indigo-200 dark:border-indigo-700 flex flex-col justify-center gap-4">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 border-b border-indigo-200 dark:border-indigo-700 pb-4">
                    <div class="flex flex-col border-b md:border-b-0 md:border-r border-indigo-200 dark:border-indigo-700 pb-2 md:pb-0"><span class="font-bold text-gray-500 dark:text-gray-400 text-xs mb-1">ğŸ“… ì´ ìˆ˜ì…</span><span class="text-xl font-bold text-gray-800 dark:text-white" id="pre-total-income-sum">0ì›</span></div>
                    <div class="flex flex-col border-b md:border-b-0 md:border-r border-indigo-200 dark:border-indigo-700 pb-2 md:pb-0"><span class="font-bold text-gray-500 dark:text-gray-400 text-xs mb-1">ğŸ’¸ ì´ ì§€ì¶œ</span><span class="text-xl font-bold text-red-600 dark:text-red-400" id="pre-total-exp-sum">0ì›</span></div>
                    <div class="flex flex-col"><span class="font-bold text-gray-500 dark:text-gray-400 text-xs mb-1">ğŸ’° ì´ ì €ì¶•</span><span class="text-xl font-bold text-indigo-700 dark:text-indigo-300" id="pre-total-save-sum">0ì›</span></div>
                </div>
                <div>
                    <div class="flex justify-between items-center text-xs text-indigo-500 dark:text-indigo-300 mb-1 font-bold"><div class="flex items-center gap-1"><span>ğŸ¯ ëª©í‘œ:</span><input type="number" id="pre-target-goal" value="500" oninput="calcPreTotals()" class="w-14 bg-indigo-50 dark:bg-gray-700 border border-indigo-200 dark:border-indigo-600 text-right p-0.5 rounded text-indigo-700 dark:text-indigo-200"><span>ë§Œì›</span></div><span id="pre-progress-text">0%</span></div>
                    <div class="relative w-full h-4 mb-3"><div class="w-full bg-indigo-100 dark:bg-gray-700 h-1.5 rounded-full overflow-hidden absolute bottom-0"><div id="pre-progress-bar" class="bg-indigo-600 dark:bg-indigo-400 h-full rounded-full transition-all duration-500" style="width: 0%"></div></div><div id="pre-milestones-container" class="absolute top-0 w-full h-full pointer-events-none"></div></div>
                    <div class="bg-white dark:bg-gray-800 rounded p-2 text-xs border border-indigo-100 dark:border-indigo-700">
                        <div class="flex justify-between items-center mb-1"><div class="flex items-center gap-2"><span class="text-gray-500 dark:text-gray-400">ğŸ ê¸°í•œ</span><span id="pre-d-day-badge" class="hidden bg-red-100 text-red-600 dark:bg-red-900 dark:text-red-200 text-[10px] font-bold px-1.5 py-0.5 rounded">D-day</span><input type="month" id="pre-target-deadline" onchange="calcPreTotals()" class="bg-transparent border-none text-indigo-600 dark:text-indigo-300 text-xs p-0 w-20 cursor-pointer focus:ring-0"></div></div>
                        <div class="flex justify-between items-center"><span class="text-gray-500 dark:text-gray-400">ğŸ“… ì˜ˆìƒ ë‹¬ì„±</span><div class="text-right"><span class="font-bold text-gray-800 dark:text-white" id="pre-prediction-date">ê³„ì‚° ì¤‘...</span><span class="ml-1" id="pre-prediction-diff"></span></div></div>
                    </div>
                </div>
            </div>
            <div class="card bg-white dark:bg-gray-800 relative flex flex-col items-center justify-center"><h3 class="text-sm font-bold text-gray-500 dark:text-gray-400 mb-2 w-full text-left">ğŸ“ˆ í”„ë¦¬ ì‹œì¦Œ ì €ì¶• ì„±ì í‘œ</h3><div class="h-40 w-full flex justify-center items-center relative"><canvas id="preSavingsChart"></canvas><div class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none"><span class="text-xs text-gray-400">ì €ì¶•ë¥ </span><span class="text-xl font-bold text-indigo-600 dark:text-indigo-400" id="preSavingsText">0%</span></div></div></div>
        </div>
    </div>

    <!-- [PAGE 3] íˆ¬ì (ìœ ì§€) -->
    <div id="page-journal" class="max-w-6xl mx-auto p-4 space-y-6 hidden">
        <div class="card bg-gray-800 dark:bg-gray-700 text-white border-none shadow-xl"><h2 class="text-2xl font-bold">ğŸ“ˆ ë‚´ ì£¼ì‹ íˆ¬ì í˜„í™©</h2><p class="text-gray-400 text-sm mt-1">í‰ë‹¨ê°€ì™€ í˜„ì¬ê°€ë¥¼ ì…ë ¥í•˜ë©´ 1ìª½ ì‹œë“œë¨¸ë‹ˆì— ìë™ ë°˜ì˜ë©ë‹ˆë‹¤.</p></div>
        <div class="card bg-white dark:bg-gray-800">
            <h3 class="font-bold text-lg mb-4 border-b dark:border-gray-700 pb-2 flex justify-between items-center">ğŸ“Š ë³´ìœ  ì¢…ëª© í¬íŠ¸í´ë¦¬ì˜¤<span class="text-xs font-normal text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded">â€» í—¤ë” í´ë¦­ì‹œ ì •ë ¬</span></h3>
            <div class="mb-6 flex justify-center border-b dark:border-gray-700 pb-6"><div class="w-full max-w-xs h-64 relative"><canvas id="stockPieChart"></canvas></div></div>
            <div class="overflow-x-auto"><table class="w-full text-sm min-w-[700px]"><thead class="bg-gray-50 dark:bg-gray-700 text-gray-500 dark:text-gray-300 border-b dark:border-gray-600"><tr><th class="p-2 text-left w-1/5 sortable" onclick="sortPortfolio('name')">ì¢…ëª©ëª… <span id="sort-name"></span></th><th class="p-2 text-right">í‰ë‹¨ê°€ / ìˆ˜ëŸ‰</th><th class="p-2 text-right">í˜„ì¬ê°€ (ê²€ìƒ‰)</th><th class="p-2 text-right">ë°°ë‹¹ê¸ˆ(1ì£¼)</th><th class="p-2 text-right sortable" onclick="sortPortfolio('val')">í‰ê°€ê¸ˆì•¡ <span id="sort-val"></span></th><th class="p-2 text-right sortable" onclick="sortPortfolio('profit')">ìˆ˜ìµê¸ˆ(ë¥ ) <span id="sort-profit">â–¼</span></th><th class="p-2 text-right sortable" onclick="sortPortfolio('div')">ë°°ë‹¹ì´ì•¡ <span id="sort-div"></span></th><th class="p-2 text-center">ì‚­ì œ</th></tr></thead><tbody id="portfolio-list" class="dark:text-gray-200"></tbody><tfoot class="bg-blue-50 dark:bg-gray-700 font-bold border-t dark:border-gray-600 dark:text-white"><tr><td class="p-3" colspan="4">ì´ í•©ê³„ (ì˜ˆìƒ ì—° ë°°ë‹¹ê¸ˆ)</td><td class="p-3 text-right" id="pf-total-val">0ì›</td><td class="p-3 text-right" id="pf-total-profit">0ì›</td><td class="p-3 text-right text-purple-600 dark:text-purple-400" id="pf-total-div">0ì›</td><td></td></tr></tfoot></table></div>
            <div class="mt-4 flex gap-2 items-center bg-gray-50 dark:bg-gray-700 p-2 rounded-lg border border-gray-200 dark:border-gray-600 overflow-x-auto"><input type="text" id="pf-name" placeholder="ì¢…ëª©ëª…" class="min-w-[100px] flex-1 dark:bg-gray-600 dark:border-gray-500 dark:text-white"><input type="number" id="pf-avg" placeholder="í‰ë‹¨ê°€" class="w-20 dark:bg-gray-600 dark:border-gray-500 dark:text-white"><input type="number" id="pf-qty" placeholder="ìˆ˜ëŸ‰" class="w-16 dark:bg-gray-600 dark:border-gray-500 dark:text-white"><input type="number" id="pf-dps" placeholder="ë°°ë‹¹ê¸ˆ" class="w-20 dark:bg-gray-600 dark:border-gray-500 dark:text-white"><button onclick="addPortfolioItem()" class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-bold text-sm hover:bg-indigo-700 whitespace-nowrap">+ ì¶”ê°€</button></div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="card bg-white dark:bg-gray-800 h-fit md:col-span-1"><h3 class="font-bold text-lg mb-4 border-b dark:border-gray-700 pb-2">âœï¸ ë§¤ë§¤ ì¼ì§€ ê¸°ë¡</h3><div class="space-y-3"><div><label class="text-xs text-gray-500 dark:text-gray-400 font-bold">ë‚ ì§œ</label><input type="date" id="j-date" class="w-full dark:bg-gray-700 dark:border-gray-600 dark:text-white"></div><div><label class="text-xs text-gray-500 dark:text-gray-400 font-bold">ì¢…ëª©ëª…</label><input type="text" id="j-name" class="w-full dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="ì¢…ëª©ëª…"></div><div class="flex gap-2"><div class="w-1/2"><label class="text-xs text-gray-500 dark:text-gray-400 font-bold">êµ¬ë¶„</label><select id="j-type" class="w-full dark:bg-gray-700 dark:border-gray-600 dark:text-white"><option value="buy" class="text-red-600">ğŸ”´ ë§¤ìˆ˜</option><option value="sell" class="text-blue-600">ğŸ”µ ë§¤ë„</option><option value="hold">âšªï¸ ê´€ë§</option></select></div><div class="w-1/2"><label class="text-xs text-gray-500 dark:text-gray-400 font-bold">ìˆ˜ëŸ‰/ê°€ê²©</label><div class="flex gap-1"><input type="number" id="j-qty" class="w-1/2 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="ì£¼"><input type="number" id="j-price" class="w-1/2 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="ê°€"></div></div></div><div><label class="text-xs text-gray-500 dark:text-gray-400 font-bold">ë©”ëª¨</label><textarea id="j-note" class="w-full h-20 resize-none dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="ë§¤ë§¤ ì´ìœ /ê°ì •"></textarea></div><button onclick="addJournal()" class="w-full bg-gray-700 dark:bg-gray-600 text-white py-2 rounded-lg font-bold hover:bg-gray-800">ì¼ì§€ ì €ì¥</button></div></div>
            <div class="card bg-white dark:bg-gray-800 md:col-span-2 flex flex-col h-[600px]"><h3 class="font-bold text-lg mb-4 border-b dark:border-gray-700 pb-2">ğŸ“‹ ë§¤ë§¤ ê¸°ë¡ ë¦¬ìŠ¤íŠ¸</h3><div class="flex-1 overflow-y-auto custom-scroll pr-2"><table class="w-full text-sm text-left"><thead class="bg-gray-50 dark:bg-gray-700 text-gray-500 dark:text-gray-300 sticky top-0"><tr><th class="p-2">ë‚ ì§œ/ì¢…ëª©</th><th class="p-2">êµ¬ë¶„</th><th class="p-2 text-right">ë‹¨ê°€</th><th class="p-2">ë©”ëª¨</th><th class="p-2 text-center">ì‚­ì œ</th></tr></thead><tbody id="journal-list" class="dark:text-gray-200"></tbody></table><div id="empty-msg" class="text-center text-gray-400 py-10 hidden">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div></div></div>
        </div>
    </div>

    <!-- [PAGE 4] ë¯¸ë˜ ì„¤ê³„ (NEW: ì´ë¦„ ë³€ê²½ & ì•ˆì „ ë¡œì§) -->
    <div id="page-future" class="max-w-6xl mx-auto p-4 space-y-6 hidden">
        <div class="card bg-gradient-to-r from-purple-600 to-indigo-600 text-white border-none shadow-xl text-center py-8">
            <h2 class="text-2xl font-bold mb-2">ğŸ‰ ê¸ˆìœµ ë‹¤ë§ˆê³ ì¹˜</h2><p class="text-purple-100 text-sm mb-6">ìì‚°ì´ ëŠ˜ì–´ë‚˜ë©´ í«ì´ ì§„í™”í•©ë‹ˆë‹¤!</p>
            <div onclick="petTalk()" class="pet-anim text-8xl mb-4 transition-transform hover:scale-110" id="pet-icon">ğŸ¥š</div>
            <div class="bg-white/20 backdrop-blur-md rounded-lg p-3 inline-block max-w-sm"><p id="pet-message" class="text-sm font-medium">"ì•„ì§ì€ ì•Œì´ì—ìš”. ì—´ì‹¬íˆ ëª¨ì•„ì£¼ì„¸ìš”!"</p></div>
            <div class="mt-6 flex justify-center gap-2 text-xs opacity-70"><span>ğŸ¥š ì•Œ (0%)</span><span>â†’</span><span>ğŸ£ ì•„ê¸° (20%)</span><span>â†’</span><span>ğŸ¥ ì–´ë¦°ì´ (40%)</span><span>â†’</span><span>ğŸ¦‰ í•™ìƒ (60%)</span><span>â†’</span><span>ğŸ¦… ë…ìˆ˜ë¦¬ (80%)</span><span>â†’</span><span>ğŸ‰ ë“œë˜ê³¤ (100%)</span></div>
        </div>

        <div class="card bg-white dark:bg-gray-800">
            <h3 class="font-bold text-lg mb-4 border-b dark:border-gray-700 pb-2 text-indigo-800 dark:text-indigo-200 flex justify-between items-center">ğŸ—ºï¸ ì—°ë„ë³„ ìì‚° ë¡œë“œë§µ<span class="text-xs font-normal text-gray-500 bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded">ì—°ë„ë¥¼ í´ë¦­í•˜ì„¸ìš”</span></h3>
            
            <!-- ì—°ë„ ì„ íƒ íƒ­ (ì—…ë°ì´íŠ¸) -->
            <div class="flex gap-2 overflow-x-auto mb-6 pb-2 custom-scroll" id="yearly-tabs"><!-- JSë¡œ ìƒì„±ë¨ --></div>

            <!-- ìƒì„¸ ë¶„ì„ í™”ë©´ -->
            <div id="yearly-detail-view" class="bg-gray-50 dark:bg-gray-700 rounded-xl p-6 text-center border dark:border-gray-600">
                <h4 class="text-2xl font-bold text-indigo-600 dark:text-indigo-300 mb-2" id="yd-title">2026 (2ë…„ì°¨) ëª©í‘œ</h4>
                <div class="flex flex-col items-center justify-center gap-4 mb-6">
                    <div class="flex items-center gap-2 justify-center">
                        <span class="text-gray-500 dark:text-gray-300 text-sm">ëª©í‘œ ê¸ˆì•¡:</span>
                        <!-- ID ì¶©ëŒ ë°©ì§€ë¥¼ ìœ„í•´ future_ ì ‘ë‘ì‚¬ ì‚¬ìš© -->
                        <input type="number" id="future_yd-input" oninput="saveFutureGoals()" class="text-xl font-bold text-right w-32 border-b-2 border-indigo-300 dark:border-indigo-500 bg-transparent focus:outline-none dark:text-white" placeholder="0">
                        <span class="text-gray-500 dark:text-gray-300">ë§Œì›</span>
                    </div>
                    <div class="w-full max-w-md">
                        <div class="flex justify-between text-xs mb-1 text-gray-500 dark:text-gray-400"><span>í˜„ì¬ ìì‚° ë‹¬ì„±ë¥ </span><span id="yd-percent">0%</span></div>
                        <div class="w-full bg-gray-200 dark:bg-gray-600 h-4 rounded-full overflow-hidden"><div id="yd-bar" class="h-full bg-indigo-500 transition-all duration-700" style="width: 0%"></div></div>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4 text-left max-w-md mx-auto">
                    <div class="bg-white dark:bg-gray-800 p-3 rounded-lg shadow-sm border dark:border-gray-600"><p class="text-xs text-gray-400">ë‚¨ì€ ê¸ˆì•¡ (Gap)</p><p class="text-lg font-bold text-red-500" id="yd-gap">0ë§Œì›</p></div>
                    <div class="bg-white dark:bg-gray-800 p-3 rounded-lg shadow-sm border dark:border-gray-600"><p class="text-xs text-gray-400">ìƒíƒœ ë©”ì‹œì§€</p><p class="text-sm font-bold text-blue-600 dark:text-blue-400" id="yd-msg">ì…ë ¥ ëŒ€ê¸°ì¤‘...</p></div>
                </div>
            </div>
        </div>
    </div>

    <!-- í•˜ë‹¨ -->
    <div class="text-center mt-12 mb-8 text-xs text-gray-400 dark:text-gray-600 space-y-4">
        <div class="flex justify-center"><button onclick="openFortuneCookie()" class="fortune-btn bg-yellow-100 dark:bg-yellow-900 border border-yellow-300 dark:border-yellow-700 px-4 py-2 rounded-full shadow-sm text-yellow-800 dark:text-yellow-200 font-bold flex items-center gap-2">ğŸ¥  ì˜¤ëŠ˜ì˜ ê¸ˆìœµ í¬ì¶˜ì¿ í‚¤ ì—´ê¸°</button></div>
        <div id="fortune-msg" class="hidden text-sm font-bold text-blue-600 dark:text-blue-400 fortune-text"></div>
        <p>âš ï¸ ë¸Œë¼ìš°ì € ìºì‹œ ì‚­ì œ ì‹œ ë°ì´í„°ê°€ ì‚¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì£¼ê¸°ì ìœ¼ë¡œ ë°±ì—…í•˜ì„¸ìš”.</p>
        <div class="flex justify-center gap-4"><button onclick="downloadBackup()" class="flex items-center gap-1 hover:text-blue-500 transition">ğŸ’¾ ë°ì´í„° ë°±ì—…</button><label class="flex items-center gap-1 hover:text-green-500 transition cursor-pointer">ğŸ“‚ ë°ì´í„° ë³µêµ¬<input type="file" class="hidden" accept=".json" onchange="restoreBackup(this)"></label></div>
        <p class="opacity-50">Designed for 2026 Financial Freedom</p>
    </div>

    <script>
        // --- ì „ì—­ ì„¤ì • ---
        let myChart=null, mainSavingsChart=null, growthChart=null, preSavingsChart=null, stockPieChart=null;
        const months=["26.04","26.05","26.06","26.07","26.08","26.09","26.10","26.11","26.12","27.01","27.02","27.03"];
        const preMonths=["25.12","26.01","26.02","26.03"];
        const defaultFieldConfig=[{key:'snp',label:'ğŸ‡ºğŸ‡¸ S&P500',color:'#3b82f6'},{key:'nasdaq',label:'ğŸ’» ë‚˜ìŠ¤ë‹¥',color:'#8b5cf6'},{key:'gold',label:'ğŸ¥‡ ê¸ˆ í˜„ë¬¼',color:'#eab308'},{key:'house',label:'ğŸ  ì£¼íƒì²­ì•½',color:'#10b981'},{key:'irp',label:'ğŸ›¡ï¸ IRP',color:'#6366f1'},{key:'savings',label:'ğŸ· ì ê¸ˆ',color:'#9ca3af'}];
        let currentFieldConfig=[], preDataStore={}, journalData=[], portfolioData=[], currentSort={key:'profit',order:'desc'};
        let achievedMilestones = new Set();
        
        // ì—°ë„ ë°ì´í„° (ìˆ˜ì •ë¨)
        const roadmapData = [
            { year: 2025, label: "2025 (1ë…„ì°¨)" },
            { year: 2026, label: "2026 (2ë…„ì°¨)" },
            { year: 2027, label: "2027 (3ë…„ì°¨)" },
            { year: 2028, label: "2028 (4ë…„ì°¨)" },
            { year: 2029, label: "2029 (5ë…„ì°¨)" },
            { year: 2030, label: "2030 (6ë…„ì°¨)" }
        ];
        let selectedYear = 2026;
        let futureGoals = {}; // 4ìª½ ì „ìš© ë°ì´í„°

        // ë‹¤í¬ëª¨ë“œ
        function loadTheme(){ const t=localStorage.getItem('theme'); if(t==='dark'||(!t&&window.matchMedia('(prefers-color-scheme: dark)').matches)){document.documentElement.classList.add('dark');updateThemeIcon(true);}else{document.documentElement.classList.remove('dark');updateThemeIcon(false);} }
        function toggleTheme(){ const isDark=document.documentElement.classList.toggle('dark'); localStorage.setItem('theme',isDark?'dark':'light'); updateThemeIcon(isDark); updateChartsTheme(isDark); }
        function updateThemeIcon(isDark){ const i=isDark?'â˜€ï¸':'ğŸŒ™'; document.getElementById('theme-icon-pc').innerText=i; document.getElementById('theme-icon-m').innerText=i; }
        function updateChartsTheme(isDark){ const tc=isDark?'#e5e7eb':'#374151', gc=isDark?'#374151':'#e5e7eb'; Chart.defaults.color=tc; Chart.defaults.borderColor=gc; [myChart,mainSavingsChart,growthChart,preSavingsChart,stockPieChart].forEach(c=>{if(c)c.update();}); }

        window.onload=function(){ loadTheme(); initApp(); setTimeout(()=>updateChartsTheme(document.documentElement.classList.contains('dark')),100); };

        function switchPage(pageName){
            ['main','pre','journal','future'].forEach(p=>{document.getElementById(`page-${p}`).classList.add('hidden');document.getElementById(`tab-${p}`).className="tab-btn inactive text-sm bg-transparent text-blue-200 dark:text-gray-400 hover:text-white";});
            document.getElementById(`page-${pageName}`).classList.remove('hidden');
            document.getElementById(`tab-${pageName}`).className="tab-btn active text-sm bg-white text-blue-600 shadow-md";
        }

        function initApp(){
            try {
                // 1, 2, 3ìª½ ì´ˆê¸°í™” (ìš°ì„  ì‹¤í–‰)
                loadFieldConfig(); initializeData(); loadSeedData(); renderMonthNav(); renderInvestmentCards(); renderIncomeCards(); renderExpenseTracker(); loadInvestmentData(); loadIncomeData(); loadExpenseData(); calculateTotalAndChart(); calculateTotalIncome(); selectMonth(months[0]);
                initPreData(); renderPreCards(); updatePreCards();
                initJournal(); initPortfolio();
            } catch (e) { console.error("Page 1-3 Init Error:", e); }

            // 4ìª½ ì´ˆê¸°í™” (ì•ˆì „í•˜ê²Œ ë¶„ë¦¬ ì‹¤í–‰)
            try {
                initFuturePage();
            } catch (e) { console.error("Page 4 Init Error:", e); }
        }

        // --- PAGE 4: FUTURE (ë…ë¦½ ë¡œì§) ---
        function initFuturePage() {
            // ë°ì´í„° ë¡œë“œ
            const s = localStorage.getItem('project2026_future_goals');
            if(s) futureGoals = JSON.parse(s);
            else futureGoals = {};

            initPet();
            renderYearlyTabs();
            updateYearlyDetailUI();
        }

        function renderYearlyTabs() {
            const container = document.getElementById('yearly-tabs');
            if(!container) return;
            container.innerHTML = roadmapData.map(d => `
                <button onclick="selectYear(${d.year})" id="y-tab-${d.year}" class="flex-shrink-0 px-4 py-2 rounded-lg text-sm font-bold border border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-500 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 whitespace-nowrap transition-all">
                    ${d.label}
                </button>
            `).join('');
            selectYear(selectedYear);
        }

        function selectYear(year) {
            selectedYear = year;
            roadmapData.forEach(d => {
                const btn = document.getElementById(`y-tab-${d.year}`);
                if(btn) {
                    if(d.year === year) btn.className = "flex-shrink-0 px-4 py-2 rounded-lg text-sm font-bold shadow-md bg-indigo-600 text-white transform scale-105 whitespace-nowrap transition-all";
                    else btn.className = "flex-shrink-0 px-4 py-2 rounded-lg text-sm font-bold border border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-500 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 whitespace-nowrap transition-all";
                }
            });
            updateYearlyDetailUI();
        }

        function saveFutureGoals() {
            const val = document.getElementById('future_yd-input').value;
            futureGoals[selectedYear] = val ? Number(val) : 0;
            localStorage.setItem('project2026_future_goals', JSON.stringify(futureGoals));
            updateYearlyDetailUI();
        }

        function updateYearlyDetailUI() {
            // í˜„ì¬ ìì‚° ê°€ì ¸ì˜¤ê¸° (ì•ˆì „í•˜ê²Œ)
            let currentAsset = 0;
            const t = document.getElementById('totalAsset');
            if(t) currentAsset = parseInt(t.innerText.replace(/[^0-9]/g,""))/10000;

            const target = futureGoals[selectedYear] || 0;
            const labelObj = roadmapData.find(d => d.year === selectedYear);
            
            const titleEl = document.getElementById('yd-title');
            const inputEl = document.getElementById('future_yd-input'); // ID ì£¼ì˜
            const bar = document.getElementById('yd-bar');
            const percentEl = document.getElementById('yd-percent');
            const gapEl = document.getElementById('yd-gap');
            const msgEl = document.getElementById('yd-msg');

            if(titleEl) titleEl.innerText = labelObj ? labelObj.label + " ëª©í‘œ" : selectedYear + "ë…„ ëª©í‘œ";
            if(inputEl) inputEl.value = target || '';

            if(target > 0) {
                const pct = Math.min((currentAsset / target) * 100, 100);
                if(bar) bar.style.width = pct + "%";
                if(percentEl) percentEl.innerText = pct.toFixed(1) + "%";

                if(currentAsset >= target) {
                    if(bar) bar.className = "h-full bg-green-500 transition-all duration-700";
                    if(gapEl) { gapEl.innerText = `+${(currentAsset - target).toLocaleString()}ë§Œ`; gapEl.className = "text-lg font-bold text-green-500"; }
                    if(msgEl) { msgEl.innerText = "ë‹¬ì„± ì™„ë£Œ! ğŸ†"; msgEl.className = "text-sm font-bold text-green-600"; }
                } else {
                    if(bar) bar.className = "h-full bg-indigo-500 transition-all duration-700";
                    if(gapEl) { gapEl.innerText = `-${(target - currentAsset).toLocaleString()}ë§Œ`; gapEl.className = "text-lg font-bold text-red-500"; }
                    if(msgEl) { msgEl.innerText = "ì§„í–‰ ì¤‘ ğŸ”¥"; msgEl.className = "text-sm font-bold text-indigo-600 dark:text-indigo-400"; }
                }
            } else {
                if(bar) bar.style.width = "0%";
                if(percentEl) percentEl.innerText = "0%";
                if(gapEl) { gapEl.innerText = "-"; gapEl.className = "text-lg font-bold text-gray-400"; }
                if(msgEl) { msgEl.innerText = "ëª©í‘œë¥¼ ì„¤ì •í•˜ì„¸ìš”."; msgEl.className = "text-sm font-bold text-gray-400"; }
            }

            // í« ì—…ë°ì´íŠ¸ (í˜„ì¬ ìì‚° ê¸°ì¤€)
            updatePetStatus(currentAsset, target); 
        }

        function initPet() {
            // í« ì´ˆê¸°í™”ëŠ” UI ì—…ë°ì´íŠ¸ ì‹œ ê°™ì´ ìˆ˜í–‰ë¨
        }
        function updatePetStatus(projSave, goal) {
            const petIcon = document.getElementById('pet-icon');
            const petMsg = document.getElementById('pet-message');
            if(!petIcon) return;
            // goalì´ 0ì´ë©´ ì „ì²´ ëª©í‘œ(2400) ê¸°ì¤€ìœ¼ë¡œ ì¬ë¯¸ ì‚¼ì•„ ë³´ì—¬ì¤Œ
            const baseGoal = goal > 0 ? goal : 2400; 
            const ratio = projSave / baseGoal;
            
            let icon="ğŸ¥š", msg="ì•„ì§ì€ ì•Œì´ì—ìš”.";
            if(ratio>=1.0) { icon="ğŸ‰"; msg="ë“œë˜ê³¤ìœ¼ë¡œ ì§„í™”! ëª©í‘œ ë‹¬ì„±!"; }
            else if(ratio>=0.8) { icon="ğŸ¦…"; msg="ë…ìˆ˜ë¦¬! ê±°ì˜ ë‹¤ ì™”ì–´ìš”."; }
            else if(ratio>=0.6) { icon="ğŸ¦‰"; msg="ë¶€ì—‰ì´! ì§€í˜œë¡­ê²Œ ëª¨ìœ¼ëŠ” ì¤‘."; }
            else if(ratio>=0.4) { icon="ğŸ¥"; msg="ë³‘ì•„ë¦¬! ì‘¥ì‘¥ í¬ê³  ìˆì–´ìš”."; }
            else if(ratio>=0.2) { icon="ğŸ£"; msg="ì•Œì„ ê¹¨ê³  ë‚˜ì™”ì–´ìš”!"; }
            
            petIcon.innerText = icon;
            petMsg.innerText = `"${msg}"`;
        }
        function petTalk() {
            const msgs = ["ë¶€ì ë˜ì„¸ìš”!", "ë³µë¦¬ì˜ ë§ˆë²•!", "ì˜¤ëŠ˜ë„ í™”ì´íŒ…!", "ë‚­ë¹„ ê¸ˆì§€!", "ê°€ì¦ˆì•„~!"];
            document.getElementById('pet-message').innerText = `"${msgs[Math.floor(Math.random()*msgs.length)]}"`;
        }

        // --- ë°±ì—…/ë³µêµ¬ ---
        function downloadBackup(){ const d={}; for(let i=0;i<localStorage.length;i++){const k=localStorage.key(i);if(k.startsWith('project2026_')||k==='theme')d[k]=localStorage.getItem(k);} const b=new Blob([JSON.stringify(d)],{type:"application/json"}); const a=document.createElement('a'); a.href=URL.createObjectURL(b); a.download=`project2026_backup_${new Date().toISOString().slice(0,10)}.json`; a.click(); }
        function restoreBackup(i){ const f=i.files[0]; if(!f)return; const r=new FileReader(); r.onload=function(e){try{const d=JSON.parse(e.target.result);for(const k in d)localStorage.setItem(k,d[k]);alert("ë³µêµ¬ ì™„ë£Œ!");location.reload();}catch(err){alert("ì˜¤ë¥˜");}}; r.readAsText(f); }

        // --- PAGE 1 ---
        function loadFieldConfig(){const s=localStorage.getItem('project2026_config_v13');currentFieldConfig=s?JSON.parse(s):JSON.parse(JSON.stringify(defaultFieldConfig));if(!s)localStorage.setItem('project2026_config_v13',JSON.stringify(currentFieldConfig));renderSettingsList();}
        function toggleSettings(){document.getElementById('settings-panel').classList.toggle('hidden');}
        function renderSettingsList(){document.getElementById('field-list').innerHTML=currentFieldConfig.map((item,i)=>`<li class="flex justify-between items-center bg-white dark:bg-gray-700 border dark:border-gray-600 p-2 rounded"><div class="flex items-center gap-2"><div class="w-4 h-4 rounded-full" style="background-color:${item.color}"></div><span>${item.label}</span></div><button onclick="deleteField(${i})" class="text-red-500 font-bold px-2">Ã—</button></li>`).join('');}
        function addNewField(){const name=document.getElementById('new-item-name').value.trim(),color=document.getElementById('new-item-color').value;if(!name)return alert("ì´ë¦„!");currentFieldConfig.push({key:'c_'+Date.now(),label:name,color});localStorage.setItem('project2026_config_v13',JSON.stringify(currentFieldConfig));document.getElementById('new-item-name').value="";renderSettingsList();renderInvestmentCards();loadInvestmentData();calculateTotalAndChart();}
        function deleteField(i){if(!confirm("ì‚­ì œ?"))return;currentFieldConfig.splice(i,1);localStorage.setItem('project2026_config_v13',JSON.stringify(currentFieldConfig));renderSettingsList();renderInvestmentCards();loadInvestmentData();calculateTotalAndChart();}
        function initializeData(){if(!localStorage.getItem('project2026_data_v13'))localStorage.setItem('project2026_data_v13',JSON.stringify({}));}
        function renderMonthNav(){document.getElementById('month-nav').innerHTML=months.map(m=>`<button onclick="selectMonth('${m}')" id="btn-${m}" class="flex-shrink-0 px-4 py-2 rounded-lg text-sm font-bold transition-all border border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-500 dark:text-gray-300 whitespace-nowrap">${m}</button>`).join('');}
        function renderInvestmentCards(){document.getElementById('monthly-container').innerHTML=months.map(m=>{const inputs=currentFieldConfig.map(f=>`<div class="flex items-center justify-between mb-2 input-group"><label class="text-gray-600 dark:text-gray-400 text-sm w-1/2 flex items-center gap-1"><span class="w-2 h-2 rounded-full inline-block" style="background-color:${f.color}"></span>${f.label}</label><div class="w-1/2"><input type="number" data-month="${m}" data-key="${f.key}" oninput="saveAndCalc()" class="bg-gray-50 dark:bg-gray-700 dark:text-white dark:border-gray-600 w-full"></div></div>`).join('');return `<div class="card bg-white dark:bg-gray-800 month-card hidden" id="card-${m}"><div class="flex justify-between items-center mb-4 pb-2 border-b dark:border-gray-700"><div class="flex flex-col"><span class="text-xs text-gray-500 dark:text-gray-400">STEP 1</span><h4 class="text-xl font-bold text-gray-800 dark:text-white">íˆ¬ì ì‹¤í–‰</h4></div><label class="flex items-center space-x-2 cursor-pointer bg-gray-100 dark:bg-gray-700 px-3 py-1.5 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600"><input type="checkbox" id="check-${m}" onchange="toggleDone('${m}')" class="w-4 h-4 text-blue-600 rounded"><span class="text-sm font-bold text-gray-600 dark:text-gray-300">ì™„ë£Œ</span></label></div><div class="space-y-1">${inputs}</div><div class="mt-4 pt-2 border-t dark:border-gray-700 flex justify-between items-center"><span class="text-xs font-bold text-gray-500 dark:text-gray-400">í•©ê³„</span><span class="font-bold text-blue-600 dark:text-blue-400" id="sum-${m}">0ë§Œì›</span></div></div>`;}).join('');}
        function renderIncomeCards(){document.getElementById('income-container').innerHTML=months.map(m=>`<div class="card bg-white dark:bg-gray-800 hidden border-l-4 border-blue-400" id="income-${m}"><div class="flex justify-between items-center mb-3"><div class="flex flex-col"><span class="text-xs text-gray-500 dark:text-gray-400">STEP 2</span><h4 class="text-lg font-bold text-gray-800 dark:text-white">ìˆ˜ì… ê¸°ë¡</h4></div></div><div class="space-y-3"><div><label class="text-xs text-gray-500 dark:text-gray-400 font-bold block">ğŸ’° ì›”ê¸‰</label><input type="number" id="salary-${m}" placeholder="0" oninput="saveIncome()" class="income-input w-full dark:bg-gray-700 dark:border-gray-600 dark:text-white"></div><div><label class="text-xs text-gray-500 dark:text-gray-400 font-bold block">ğŸ ìˆ˜ë‹¹</label><input type="number" id="bonus-${m}" placeholder="0" oninput="saveIncome()" class="income-input w-full dark:bg-gray-700 dark:border-gray-600 dark:text-white"></div></div><div class="mt-3 pt-2 border-t dark:border-gray-700 border-blue-100 flex justify-between items-center"><span class="text-xs font-bold text-gray-500 dark:text-gray-400">ì´ ìˆ˜ì…</span><span class="font-bold text-gray-700 dark:text-white" id="income-total-${m}">0ë§Œì›</span></div></div>`).join('');}
        function renderExpenseTracker(){document.getElementById('expense-container').innerHTML=months.map(m=>`<div class="flex items-center justify-between py-1"><span class="text-sm font-bold text-gray-500 dark:text-gray-400 w-16">${m}</span><div class="flex-1 relative"><input type="number" id="exp-${m}" placeholder="0" oninput="saveExpense()" class="w-full pr-8 dark:bg-gray-700 dark:border-gray-600 dark:text-white"><span class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 text-xs pointer-events-none">ì›</span></div></div>`).join('');}
        function loadSeedData(){const s=JSON.parse(localStorage.getItem('project2026_seed_v17'))||{deposit:0,savings:0,house:0,bond:0};document.getElementById('seed-deposit').value=s.deposit||'';document.getElementById('seed-savings').value=s.savings||'';document.getElementById('seed-house').value=s.house||'';document.getElementById('seed-bond').value=s.bond||'';}
        function saveSeedData(){const s={deposit:Number(document.getElementById('seed-deposit').value),savings:Number(document.getElementById('seed-savings').value),house:Number(document.getElementById('seed-house').value),bond:Number(document.getElementById('seed-bond').value)};localStorage.setItem('project2026_seed_v17',JSON.stringify(s));calculateTotalAndChart();if(!document.getElementById('page-future').classList.contains('hidden')) updateYearlyDetailUI();}
        function getDetailedSeedTotal(){const d=Number(document.getElementById('seed-deposit').value)||0,s=Number(document.getElementById('seed-savings').value)||0,h=Number(document.getElementById('seed-house').value)||0,b=Number(document.getElementById('seed-bond').value)||0,st=Number(document.getElementById('seed-stock').value)||0;const t=d+s+h+b+st;document.getElementById('seed-total-display').innerText=t.toLocaleString()+"ë§Œì›";return t;}
        function saveAndCalc(){const d={};document.querySelectorAll('#monthly-container input[type="number"]').forEach(i=>{const m=i.dataset.month,k=i.dataset.key;if(!d[m])d[m]={};d[m][k]=Number(i.value);});localStorage.setItem('project2026_data_v13',JSON.stringify(d));calculateTotalAndChart();if(!document.getElementById('page-future').classList.contains('hidden')) updateYearlyDetailUI();}
        function calculateTotalAndChart(){const b=getDetailedSeedTotal();let t=Number(document.getElementById('target-goal').value)||2400;localStorage.setItem('project2026_target_goal',t);let g=b,p=0,c={};currentFieldConfig.forEach(f=>c[f.key]=0);let gr=[],run=b;let avgP=0,cnt=0;
            months.forEach(m=>{
                const i=document.querySelectorAll(`input[data-month="${m}"]`);let s=0;
                i.forEach(inp=>{const v=Number(inp.value);s+=v;if(document.getElementById(`check-${m}`).checked){const k=inp.dataset.key;if(c[k]!==undefined)c[k]+=v;}});
                document.getElementById(`sum-${m}`).innerText=s.toLocaleString()+"ë§Œì›";
                if(document.getElementById(`check-${m}`).checked){g+=s;p+=s;run+=s;}else{avgP+=s;cnt++;}gr.push(run);
            });
            document.getElementById('totalAsset').innerText=(g*10000).toLocaleString()+"ì›";
            const pct=Math.min((p/t)*100,100).toFixed(1);document.getElementById('progress-bar').style.width=pct+"%";document.getElementById('progress-text').innerText=pct+"%";updateChart(c);updateMainSavingsChart(p);updateGrowthChart(gr);
            updateLevelBadge(g); renderMilestones(t, 'milestones-container', g); checkMilestoneReached(g, 'main', t);
            
            // Prediction
            const td=localStorage.getItem('project2026_target_date'); if(td)document.getElementById('target-deadline').value=td;
            const targetDateStr=document.getElementById('target-deadline').value; if(targetDateStr) localStorage.setItem('project2026_target_date', targetDateStr);
            const dDayEl = document.getElementById('d-day-badge');
            if(targetDateStr) {
                const today = new Date(); today.setHours(0,0,0,0); const tDate = new Date(targetDateStr + "-01");
                const diff = Math.ceil((tDate - today) / (1000 * 60 * 60 * 24));
                dDayEl.innerText = diff > 0 ? `D-${diff}` : (diff === 0 ? "D-Day" : `D+${Math.abs(diff)}`); dDayEl.classList.remove('hidden');
            } else { dDayEl.classList.add('hidden'); }
            const remaining = (t - g)*10000; const speed = (months.length > 0) ? (avgP / Math.max(cnt,1)) * 10000 : 0;
            const predEl = document.getElementById('prediction-date'); const diffEl = document.getElementById('prediction-diff');
            if(remaining <= 0) { predEl.innerText = "ëª©í‘œ ë‹¬ì„±! ğŸ‰"; predEl.className="font-bold text-green-400"; diffEl.innerText=""; }
            else if(speed <= 0) { predEl.innerText = "ë°ì´í„° ë¶€ì¡±"; predEl.className="font-bold text-gray-400"; diffEl.innerText=""; }
            else {
                const monthsNeeded = Math.ceil(remaining / speed); const today = new Date(); const predDate = new Date(today.getFullYear(), today.getMonth() + monthsNeeded, 1);
                predEl.innerText = `${predDate.getFullYear()}ë…„ ${predDate.getMonth()+1}ì›”`; predEl.className="font-bold text-white";
                if(targetDateStr) {
                    const targetD = new Date(targetDateStr); const diffMonths = (targetD.getFullYear() - predDate.getFullYear()) * 12 + (targetD.getMonth() - predDate.getMonth());
                    if(diffMonths > 0) { diffEl.innerText = `+${diffMonths}ê°œì›” ë‹¨ì¶•! ğŸš€`; diffEl.className="text-xs text-green-400 font-bold"; }
                    else if(diffMonths < 0) { diffEl.innerText = `${diffMonths}ê°œì›” ì§€ì—°... ğŸ¢`; diffEl.className="text-xs text-red-400 font-bold"; }
                    else { diffEl.innerText = "ì¼ì • ì™„ë²½! ğŸ‘Œ"; diffEl.className="text-xs text-blue-300 font-bold"; }
                } else { diffEl.innerText = "ëª©í‘œ ê¸°í•œ ë¯¸ì„¤ì •"; diffEl.className="text-xs text-gray-400"; }
            }
        }
        function updateLevelBadge(currentAsset) {
            const badge = document.getElementById('level-badge'); const nextGap = document.getElementById('next-level-gap');
            let level="ğŸŒ± ì”¨ì•—", nextLevel=1000, colorClass="bg-green-100 text-green-800";
            if(currentAsset >= 30000) { level="ğŸ‘‘ ë§ˆìŠ¤í„°"; nextLevel=0; colorClass="bg-purple-100 text-purple-800"; }
            else if(currentAsset >= 14000) { level="ğŸ’ ë‹¤ì´ì•„ëª¬ë“œ"; nextLevel=30000; colorClass="bg-blue-100 text-blue-800"; }
            else if(currentAsset >= 7000) { level="ğŸ¥‡ ê³¨ë“œ"; nextLevel=14000; colorClass="bg-yellow-100 text-yellow-800"; }
            else if(currentAsset >= 3000) { level="ğŸ¥ˆ ì‹¤ë²„"; nextLevel=7000; colorClass="bg-gray-200 text-gray-800"; }
            else if(currentAsset >= 1000) { level="ğŸ¥‰ ë¸Œë¡ ì¦ˆ"; nextLevel=3000; colorClass="bg-orange-100 text-orange-800"; }
            badge.innerText = level; badge.className = `px-3 py-1 rounded-full text-xs font-bold backdrop-blur-sm border border-white/30 ${colorClass}`;
            const prevLevel = localStorage.getItem('project2026_level');
            if(prevLevel && prevLevel !== level) { badge.classList.add('level-up-anim'); triggerConfetti(); setTimeout(()=>badge.classList.remove('level-up-anim'), 1000); }
            localStorage.setItem('project2026_level', level);
            nextGap.innerText = nextLevel > 0 ? `ë‹¤ìŒ ë ˆë²¨ê¹Œì§€ ${(nextLevel - currentAsset).toLocaleString()}ë§Œ` : "ìµœê³  ë ˆë²¨ ë‹¬ì„±!";
        }
        function renderMilestones(goal, containerId, current) {
            const container = document.getElementById(containerId); if(!container || goal <= 0) return; container.innerHTML = ""; const step = 1000;
            for(let m = step; m < goal; m += step) {
                const pos = (m / goal) * 100; const achieved = current >= m;
                const color = achieved ? "#4ade80" : "#ffffff"; const opacity = achieved ? "1" : "0.5"; const animation = achieved ? "milestone-achieved" : "";
                const marker = document.createElement("div"); marker.className = `milestone-marker absolute bottom-0 flex flex-col items-center pointer-events-none ${animation}`; marker.style.left = pos + "%";
                marker.innerHTML = `<div class="milestone-flag text-[10px] mb-0.5" style="color:${color}; opacity:${opacity}">ğŸš©</div><div class="milestone-line w-px h-1.5 bg-white bg-opacity-30"></div>`;
                container.appendChild(marker);
            }
        }
        function checkMilestoneReached(current, page, goal) {
            const step = 1000; const currentLevel = Math.floor(current / step) * step;
            if(current >= goal && goal > 0) { const key = `${page}_goal_${goal}`; if(!achievedMilestones.has(key)) { triggerFinale(); achievedMilestones.add(key); } return; }
            if (currentLevel > 0) { const key = `${page}_${currentLevel}`; if(!achievedMilestones.has(key)) { triggerConfetti(); achievedMilestones.add(key); } }
        }
        function triggerConfetti() { confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 }, colors: ['#3b82f6', '#10b981', '#f59e0b'] }); }
        function triggerFinale() { var duration = 3 * 1000; var end = Date.now() + duration; (function frame() { confetti({ particleCount: 3, angle: 60, spread: 55, origin: { x: 0 }, colors: ['#3b82f6', '#10b981'] }); confetti({ particleCount: 3, angle: 120, spread: 55, origin: { x: 1 }, colors: ['#f59e0b', '#ec4899'] }); if (Date.now() < end) requestAnimationFrame(frame); }()); }

        function updateChart(d){const ctx=document.getElementById('portfolioChart').getContext('2d'),l=currentFieldConfig.map(f=>f.label),c=currentFieldConfig.map(f=>f.color),ds=currentFieldConfig.map(f=>d[f.key]);if(myChart){myChart.data.labels=l;myChart.data.datasets[0].data=ds;myChart.data.datasets[0].backgroundColor=c;myChart.update();}else{myChart=new Chart(ctx,{type:'doughnut',data:{labels:l,datasets:[{data:ds,backgroundColor:c,borderWidth:0}]},options:{responsive:true,plugins:{legend:{position:'right',labels:{boxWidth:10,font:{size:10}}}}}})}}
        function updateGrowthChart(d){const ctx=document.getElementById('growthChart').getContext('2d');if(growthChart){growthChart.data.datasets[0].data=d;growthChart.update();}else{growthChart=new Chart(ctx,{type:'line',data:{labels:months,datasets:[{label:'ëˆ„ì  ìì‚°',data:d,borderColor:'#2563eb',backgroundColor:'rgba(37,99,235,0.1)',borderWidth:2,tension:0.3,fill:true,pointBackgroundColor:'#2563eb'}]},options:{responsive:true,plugins:{legend:{display:false}},scales:{y:{grid:{borderDash:[2,4]}},x:{display:false}}}})}}
        function updateMainSavingsChart(proj){if(proj===undefined)return;const incStr=document.getElementById('totalIncomeDisplay').innerText,inc=parseInt(incStr.replace(/[^0-9]/g,""))||0,pWon=proj*10000;let r=0,exp=0;if(inc>0){r=Math.min((pWon/inc)*100,100).toFixed(1);exp=inc-pWon;if(exp<0)exp=0;}document.getElementById('mainSavingsText').innerText=r+"%";const ctx=document.getElementById('mainSavingsChart').getContext('2d');if(mainSavingsChart){mainSavingsChart.data.datasets[0].data=[pWon,exp];mainSavingsChart.update();}else{mainSavingsChart=new Chart(ctx,{type:'doughnut',data:{datasets:[{data:[pWon,exp],backgroundColor:['#2563eb','#e5e7eb'],borderWidth:0,cutout:'75%'}]},options:{responsive:true,plugins:{legend:{display:false},tooltip:{enabled:false}}}})}}
        function saveIncome(){const d={};months.forEach(m=>{const s=Number(document.getElementById(`salary-${m}`).value),b=Number(document.getElementById(`bonus-${m}`).value);d[m]={salary:s,bonus:b};});localStorage.setItem('project2026_income_v13',JSON.stringify(d));calculateTotalIncome();}
        function calculateTotalIncome(){let t=0;months.forEach(m=>{t+=(Number(document.getElementById(`salary-${m}`).value)+Number(document.getElementById(`bonus-${m}`).value));});document.getElementById('totalIncomeDisplay').innerText=(t*10000).toLocaleString()+"ì›";updateMainSavingsChart();}
        function saveExpense(){const d={};let t=0,c=0;months.forEach(m=>{const v=Number(document.getElementById(`exp-${m}`).value);if(v>0){d[m]=v;t+=v;c++;}});localStorage.setItem('project2026_expenses_v13',JSON.stringify(d));document.getElementById('totalExpense').innerText=t.toLocaleString()+"ì›";document.getElementById('avgExpense').innerText=(c>0?Math.round(t/c):0).toLocaleString()+"ì›";}
        function loadIncomeData(){const s=JSON.parse(localStorage.getItem('project2026_income_v13'))||{};Object.keys(s).forEach(m=>{if(document.getElementById(`salary-${m}`)){document.getElementById(`salary-${m}`).value=s[m].salary||'';document.getElementById(`bonus-${m}`).value=s[m].bonus||'';}});saveIncome();}
        function loadExpenseData(){const s=JSON.parse(localStorage.getItem('project2026_expenses_v13'))||{};Object.keys(s).forEach(m=>{const e=document.getElementById(`exp-${m}`);if(e)e.value=s[m];});saveExpense();}
        function loadInvestmentData(){const d=JSON.parse(localStorage.getItem('project2026_data_v13')),c=JSON.parse(localStorage.getItem('project2026_checks_v13'))||{},mm=localStorage.getItem('project2026_memo_v13')||"";if(d){Object.keys(d).forEach(m=>{Object.keys(d[m]).forEach(k=>{const e=document.querySelector(`input[data-month="${m}"][data-key="${k}"]`);if(e)e.value=d[m][k];});});}Object.keys(c).forEach(m=>{const ch=document.getElementById(`check-${m}`);if(ch&&c[m]){ch.checked=true;document.getElementById(`card-${m}`).classList.add('done');}});document.getElementById('memoArea').value=mm;const tg=localStorage.getItem('project2026_target_goal');if(tg)document.getElementById('target-goal').value=tg;}
        function toggleDone(m){const ch=document.getElementById(`check-${m}`),cd=document.getElementById(`card-${m}`);if(ch.checked)cd.classList.add('done');else cd.classList.remove('done');const c=JSON.parse(localStorage.getItem('project2026_checks_v13'))||{};c[m]=ch.checked;localStorage.setItem('project2026_checks_v13',JSON.stringify(c));calculateTotalAndChart();selectMonth(m);}
        function selectMonth(t){months.forEach(m=>{const b=document.getElementById(`btn-${m}`),ch=document.getElementById(`check-${m}`).checked;if(m===t){b.className="flex-shrink-0 px-4 py-2 rounded-lg text-sm font-bold shadow-md bg-blue-600 text-white transform scale-105 transition-all whitespace-nowrap";document.getElementById(`card-${m}`).classList.remove('hidden');document.getElementById(`income-${m}`).classList.remove('hidden');}else{b.className=ch?"flex-shrink-0 px-4 py-2 rounded-lg text-sm font-bold border border-blue-200 dark:border-blue-700 bg-blue-50 dark:bg-blue-900 text-blue-600 dark:text-blue-200 transition-all whitespace-nowrap":"flex-shrink-0 px-4 py-2 rounded-lg text-sm font-bold border border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-500 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 transition-all whitespace-nowrap";document.getElementById(`card-${m}`).classList.add('hidden');document.getElementById(`income-${m}`).classList.add('hidden');}});document.getElementById('current-month-display').innerText=t;}
        document.getElementById('memoArea').addEventListener('input',function(){localStorage.setItem('project2026_memo_v13',this.value);});

        // --- PAGE 2 ---
        function initPreData(){const s=localStorage.getItem('project2026_pre_v13');if(s)preDataStore=JSON.parse(s);else preMonths.forEach(m=>{preDataStore[m]={salary:0,other:0,manualTotalExp:0,items:[]};});
            const pt = localStorage.getItem('project2026_pre_target');
            if(pt) document.getElementById('pre-target-goal').value = pt;
            const pd = localStorage.getItem('project2026_pre_target_date');
            if(pd) document.getElementById('pre-target-deadline').value = pd;
        }
        function renderPreCards(){document.getElementById('pre-container').innerHTML=preMonths.map(m=>`<div class="card bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 flex flex-col h-full" id="pre-card-${m}"><h3 class="font-bold text-lg mb-3 text-indigo-700 dark:text-indigo-300 pb-2 border-b dark:border-gray-700 flex justify-between">${m}<span class="text-xs text-gray-400 font-normal self-end">ì¤€ë¹„ê¸°ê°„</span></h3><div class="mb-4 bg-indigo-50 dark:bg-gray-700 p-2 rounded-lg"><label class="block text-xs font-bold text-gray-500 dark:text-gray-300 mb-1">ğŸ“¥ ìˆ˜ì…</label><div class="flex gap-2"><input type="number" placeholder="ì›”ê¸‰" id="pre-salary-${m}" onchange="updatePreData('${m}')" class="w-1/2 text-sm dark:bg-gray-600 dark:border-gray-500 dark:text-white"><input type="number" placeholder="ìˆ˜ë‹¹" id="pre-other-${m}" onchange="updatePreData('${m}')" class="w-1/2 text-sm dark:bg-gray-600 dark:border-gray-500 dark:text-white"></div></div><div class="mb-2 flex justify-between items-center px-1"><span class="text-xs font-bold text-gray-500 dark:text-gray-400">ëª©í‘œ ì§€ì¶œì•¡:</span><input type="number" id="pre-manual-exp-${m}" onchange="updatePreData('${m}')" class="w-20 border rounded p-1 text-right text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="0"></div><div class="flex-1 overflow-y-auto mb-2 pr-1 custom-scroll" style="min-height: 120px; max-height: 200px;"><table class="w-full text-xs"><thead class="text-gray-400 border-b dark:border-gray-700"><tr><th class="text-left pb-1">ë‚´ì—­</th><th class="text-right pb-1">ê¸ˆì•¡</th><th class="text-center pb-1">ì €ì¶•?</th><th></th></tr></thead><tbody id="pre-list-${m}" class="dark:text-gray-200"></tbody></table></div><button onclick="addPreRow('${m}')" class="w-full py-1.5 text-xs font-bold text-indigo-600 dark:text-indigo-400 border border-indigo-200 dark:border-gray-600 rounded hover:bg-indigo-50 dark:hover:bg-gray-700 mb-4">+ í•­ëª© ì¶”ê°€</button><div class="pt-2 border-t dark:border-gray-700 space-y-1"><div class="flex justify-between items-center text-xs"><span class="text-gray-500 dark:text-gray-400">ë¦¬ìŠ¤íŠ¸ ì§€ì¶œ í•©ê³„:</span><span class="font-bold text-red-500 dark:text-red-400" id="pre-sum-exp-${m}">0</span></div><div class="flex justify-between items-center text-sm"><span class="font-bold text-gray-600 dark:text-gray-300">ë¦¬ìŠ¤íŠ¸ ì €ì¶• í•©ê³„:</span><span class="font-bold text-blue-600 dark:text-blue-400" id="pre-sum-save-${m}">0</span></div></div></div>`).join('');}
        function updatePreCards(){preMonths.forEach(m=>{const d=preDataStore[m]||{salary:0,other:0,manualTotalExp:0,items:[]};document.getElementById(`pre-salary-${m}`).value=d.salary||'';document.getElementById(`pre-other-${m}`).value=d.other||'';document.getElementById(`pre-manual-exp-${m}`).value=d.manualTotalExp||'';renderPreListRows(m);});calcPreTotals();}
        function renderPreListRows(m){document.getElementById(`pre-list-${m}`).innerHTML=preDataStore[m].items.map((it,i)=>`<tr class="border-b border-gray-100 dark:border-gray-700 last:border-0"><td class="py-1"><input type="text" value="${it.name}" onchange="updatePreItem('${m}',${i},'name',this.value)" class="w-full bg-transparent p-0 text-gray-700 dark:text-gray-300" placeholder="í•­ëª©ëª…"></td><td class="py-1"><input type="number" value="${it.amount}" onchange="updatePreItem('${m}',${i},'amount',this.value)" class="w-14 bg-transparent p-0 text-right font-bold dark:text-gray-200" placeholder="0"></td><td class="py-1 text-center"><input type="checkbox" ${it.isSaving?'checked':''} onchange="updatePreItem('${m}',${i},'isSaving',this.checked)" class="w-3 h-3 text-blue-600 rounded"></td><td class="py-1 text-right"><button onclick="deletePreRow('${m}',${i})" class="text-gray-300 hover:text-red-500">Ã—</button></td></tr>`).join('');}
        function updatePreData(m){if(!preDataStore[m])preDataStore[m]={items:[]};preDataStore[m].salary=Number(document.getElementById(`pre-salary-${m}`).value);preDataStore[m].other=Number(document.getElementById(`pre-other-${m}`).value);preDataStore[m].manualTotalExp=Number(document.getElementById(`pre-manual-exp-${m}`).value);savePreStore();calcPreTotals();}
        function addPreRow(m){if(!preDataStore[m])preDataStore[m]={items:[]};preDataStore[m].items.push({name:"",amount:0,isSaving:false});savePreStore();renderPreListRows(m);calcPreTotals();}
        function deletePreRow(m,i){preDataStore[m].items.splice(i,1);savePreStore();renderPreListRows(m);calcPreTotals();}
        function updatePreItem(m,i,f,v){if(f==='amount')v=Number(v);preDataStore[m].items[i][f]=v;savePreStore();calcPreTotals();}
        
        function calcPreTotals(){
            let ts=0,ti=0,te=0;
            const pt = Number(document.getElementById('pre-target-goal').value) || 500;
            localStorage.setItem('project2026_pre_target', pt);
            
            const pd = document.getElementById('pre-target-deadline').value;
            if(pd) localStorage.setItem('project2026_pre_target_date', pd);

            const dDayEl = document.getElementById('pre-d-day-badge');
            if(pd) {
                const today = new Date(); today.setHours(0,0,0,0);
                const tDate = new Date(pd + "-01");
                const diff = Math.ceil((tDate - today) / (1000 * 60 * 60 * 24));
                dDayEl.innerText = diff > 0 ? `D-${diff}` : (diff === 0 ? "D-Day" : `D+${Math.abs(diff)}`);
                dDayEl.classList.remove('hidden');
            } else { dDayEl.classList.add('hidden'); }

            preMonths.forEach(m=>{
                const d=preDataStore[m]; let se=0,ss=0; ti+=(d.salary||0)+(d.other||0); 
                d.items.forEach(it=>{if(it.isSaving)ss+=it.amount;else se+=it.amount;}); 
                document.getElementById(`pre-sum-exp-${m}`).innerText=se.toLocaleString();
                document.getElementById(`pre-sum-save-${m}`).innerText=ss.toLocaleString()+"ë§Œ";
                ts+=ss; te+=se;
            });
            document.getElementById('pre-total-save-sum').innerText=(ts*10000).toLocaleString()+"ì›";
            document.getElementById('pre-total-income-sum').innerText=(ti*10000).toLocaleString()+"ì›";
            document.getElementById('pre-total-exp-sum').innerText=(te*10000).toLocaleString()+"ì›";
            updatePreSavingsChart(ti,ts);
            
            const pct = Math.min((ts/pt)*100, 100).toFixed(1);
            document.getElementById('pre-progress-bar').style.width=pct+"%";
            document.getElementById('pre-progress-text').innerText=pct+"%";

            renderMilestones(pt, 'pre-milestones-container', ts);
            checkMilestoneReached(ts, 'pre', pt);

            const remaining = (pt - ts)*10000;
            const speed = (preMonths.length > 0) ? (ts / 4) * 10000 : 0; 
            const predEl = document.getElementById('pre-prediction-date');
            const diffEl = document.getElementById('pre-prediction-diff');

            if(remaining <= 0) { predEl.innerText = "ë‹¬ì„± ì™„ë£Œ!"; predEl.className="font-bold text-green-500"; diffEl.innerText=""; }
            else if(speed <= 0) { predEl.innerText = "ë°ì´í„° ë¶€ì¡±"; predEl.className="font-bold text-gray-400"; diffEl.innerText=""; }
            else {
                const startDate = new Date(2025, 11, 1); 
                const monthsNeeded = Math.ceil(remaining / speed);
                const predDate = new Date(startDate);
                predDate.setMonth(startDate.getMonth() + monthsNeeded);
                predEl.innerText = `${predDate.getFullYear()}ë…„ ${predDate.getMonth()+1}ì›”`;
                predEl.className="font-bold text-indigo-600 dark:text-white";

                if(pd) {
                    const targetD = new Date(pd);
                    const diffMonths = (targetD.getFullYear() - predDate.getFullYear()) * 12 + (targetD.getMonth() - predDate.getMonth());
                    if(diffMonths > 0) { diffEl.innerText = `(+${diffMonths}ê°œì›” ë‹¨ì¶•)`; diffEl.className="text-xs text-green-500 font-bold"; }
                    else if(diffMonths < 0) { diffEl.innerText = `(${diffMonths}ê°œì›” ì§€ì—°)`; diffEl.className="text-xs text-red-500 font-bold"; }
                    else { diffEl.innerText = "(ë”± ë§ìŒ)"; diffEl.className="text-xs text-blue-500 font-bold"; }
                } else { diffEl.innerText = ""; }
            }
        }
        
        function updatePreSavingsChart(inc,sav){let r=0,exp=0;if(inc>0){r=Math.min((sav/inc)*100,100).toFixed(1);exp=inc-sav;if(exp<0)exp=0;}document.getElementById('preSavingsText').innerText=r+"%";const ctx=document.getElementById('preSavingsChart').getContext('2d');if(preSavingsChart){preSavingsChart.data.datasets[0].data=[sav,exp];preSavingsChart.update();}else{preSavingsChart=new Chart(ctx,{type:'doughnut',data:{labels:['ì €ì¶•','ì§€ì¶œ'],datasets:[{data:[sav,exp],backgroundColor:['#4f46e5','#e5e7eb'],borderWidth:0,cutout:'75%'}]},options:{responsive:true,plugins:{legend:{display:false},tooltip:{enabled:false}}}})}}
        function savePreStore(){localStorage.setItem('project2026_pre_v13',JSON.stringify(preDataStore));}

        // --- PAGE 3 ---
        function initJournal(){const s=localStorage.getItem('project2026_journal_v14');journalData=s?JSON.parse(s):[];document.getElementById('j-date').valueAsDate=new Date();renderJournalList();}
        function addJournal(){const d=document.getElementById('j-date').value,n=document.getElementById('j-name').value;if(!d||!n)return alert("ë‚ ì§œ/ì¢…ëª©ëª… í•„ìˆ˜");journalData.push({id:Date.now(),date:d,name:n,type:document.getElementById('j-type').value,qty:document.getElementById('j-qty').value,price:document.getElementById('j-price').value,note:document.getElementById('j-note').value});journalData.sort((a,b)=>new Date(b.date)-new Date(a.date));localStorage.setItem('project2026_journal_v14',JSON.stringify(journalData));renderJournalList();document.getElementById('j-name').value="";document.getElementById('j-note').value="";}
        function deleteJournal(id){if(!confirm("ì‚­ì œ?"))return;journalData=journalData.filter(i=>i.id!==id);localStorage.setItem('project2026_journal_v14',JSON.stringify(journalData));renderJournalList();}
        function renderJournalList(){const b=document.getElementById('journal-list'),e=document.getElementById('empty-msg');if(journalData.length===0){b.innerHTML="";e.classList.remove('hidden');return;}e.classList.add('hidden');b.innerHTML=journalData.map(i=>{let t="";if(i.type==='buy')t=`<span class="bg-red-100 dark:bg-red-900 text-red-600 dark:text-red-300 px-2 py-0.5 rounded text-xs font-bold">ë§¤ìˆ˜</span>`;else if(i.type==='sell')t=`<span class="bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-300 px-2 py-0.5 rounded text-xs font-bold">ë§¤ë„</span>`;else t=`<span class="bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 px-2 py-0.5 rounded text-xs font-bold">ê´€ë§</span>`;return `<tr class="border-b dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700"><td class="p-2 align-top text-xs text-gray-500 dark:text-gray-400"><div>${i.date}</div><div class="font-bold text-gray-700 dark:text-gray-200">${i.name}</div></td><td class="p-2 align-top">${t}</td><td class="p-2 align-top text-right text-xs"><div class="dark:text-gray-200">${Number(i.price).toLocaleString()}ì›</div><div class="text-gray-400">${i.qty}ì£¼</div></td><td class="p-2 align-top text-xs text-gray-600 dark:text-gray-300 whitespace-pre-wrap">${i.note}</td><td class="p-2 align-top text-center"><button onclick="deleteJournal(${i.id})" class="text-gray-300 hover:text-red-500 font-bold">Ã—</button></td></tr>`;}).join('');}
        
        // --- PAGE 3: Portfolio ---
        function initPortfolio(){const s=localStorage.getItem('project2026_portfolio_v18_1');portfolioData=s?JSON.parse(s):[];renderPortfolio();}
        function addPortfolioItem(){const name=document.getElementById('pf-name').value,avg=document.getElementById('pf-avg').value,qty=document.getElementById('pf-qty').value,dps=document.getElementById('pf-dps').value;if(!name||!avg||!qty)return alert("ëª¨ë‘ ì…ë ¥");portfolioData.push({id:Date.now(),name,avg:Number(avg),qty:Number(qty),current:Number(avg),dps:Number(dps)||0});savePortfolio();renderPortfolio();document.getElementById('pf-name').value="";document.getElementById('pf-avg').value="";document.getElementById('pf-qty').value="";document.getElementById('pf-dps').value="";}
        function deletePortfolioItem(id){if(!confirm("ì‚­ì œ?"))return;portfolioData=portfolioData.filter(i=>i.id!==id);savePortfolio();renderPortfolio();}
        function updateItem(id,field,value){const item=portfolioData.find(i=>i.id===id);if(item){item[field]=Number(value);savePortfolio();renderPortfolio();}}
        
        function sortPortfolio(key) {
            if(currentSort.key === key) currentSort.order = currentSort.order === 'asc' ? 'desc' : 'asc';
            else { currentSort.key = key; currentSort.order = 'desc'; }
            ['name','val','profit','div'].forEach(k => document.getElementById(`sort-${k}`).innerText = "");
            document.getElementById(`sort-${key}`).innerText = currentSort.order === 'asc' ? "â–²" : "â–¼";
            portfolioData.sort((a,b) => {
                let va, vb;
                if(key === 'name') { va=a.name; vb=b.name; }
                else if(key === 'val') { va=a.current*a.qty; vb=b.current*b.qty; }
                else if(key === 'profit') { va=(a.current-a.avg)*a.qty; vb=(b.current-b.avg)*b.qty; }
                else if(key === 'div') { va=a.dps*a.qty; vb=b.dps*b.qty; }
                if(va < vb) return currentSort.order === 'asc' ? -1 : 1;
                if(va > vb) return currentSort.order === 'asc' ? 1 : -1;
                return 0;
            });
            renderPortfolio();
        }

        function renderPortfolio(){
            const tbody=document.getElementById('portfolio-list');let tv=0,tp=0,ti=0,td=0;
            const chartLabels = [], chartData = [];
            tbody.innerHTML=portfolioData.map(item=>{
                const inv=item.avg*item.qty,val=item.current*item.qty,prof=val-inv,rate=inv>0?(prof/inv)*100:0;
                const divSum=item.dps*item.qty, divRate=item.current>0?(item.dps/item.current)*100:0;
                ti+=inv;tv+=val;tp+=prof;td+=divSum;
                chartLabels.push(item.name); chartData.push(val);
                const c=prof>0?"text-up bg-up-light":(prof<0?"text-down bg-down-light":"");
                const searchLink=`https://search.naver.com/search.naver?query=ì£¼ê°€+${encodeURIComponent(item.name)}`;
                return `<tr class="border-b dark:border-gray-700 last:border-0 hover:bg-gray-50 dark:hover:bg-gray-700"><td class="p-2 font-bold text-gray-700 dark:text-gray-200">${item.name}<a href="${searchLink}" target="_blank" class="ml-1 text-xs bg-green-500 text-white px-1.5 py-0.5 rounded hover:bg-green-600 no-underline font-normal">N</a></td><td class="p-2 text-right text-xs text-gray-500 dark:text-gray-400"><div>${item.avg.toLocaleString()}</div><div>x ${item.qty}</div></td><td class="p-2 text-right"><input type="number" value="${item.current}" onchange="updateItem(${item.id},'current',this.value)" class="w-20 text-right p-1 border rounded text-sm font-bold bg-white dark:bg-gray-600 dark:border-gray-500 dark:text-white focus:bg-yellow-50 dark:focus:bg-gray-500"></td><td class="p-2 text-right"><input type="number" value="${item.dps}" onchange="updateItem(${item.id},'dps',this.value)" class="w-16 text-right p-1 border rounded text-xs bg-gray-50 dark:bg-gray-700 dark:text-gray-200 focus:bg-white"></td><td class="p-2 text-right font-medium dark:text-gray-200 text-xs">${val.toLocaleString()}</td><td class="p-2 text-right font-bold text-xs ${c}"><div>${prof>0?"+"+prof.toLocaleString():prof.toLocaleString()}</div><div>(${rate>0?"+"+rate.toFixed(1):rate.toFixed(1)}%)</div></td><td class="p-2 text-right text-xs text-gray-600 dark:text-gray-400"><div>${divSum.toLocaleString()}</div><div class="text-[10px]">(${divRate.toFixed(1)}%)</div></td><td class="p-2 text-center"><button onclick="deletePortfolioItem(${item.id})" class="text-gray-300 hover:text-red-500 font-bold">Ã—</button></td></tr>`;
            }).join('');
            const tr=ti>0?(tp/ti)*100:0,tc=tp>0?"text-up":(tp<0?"text-down":"");
            document.getElementById('pf-total-val').innerText=tv.toLocaleString()+"ì›";
            document.getElementById('pf-total-rate').innerHTML=`<span class="${tc}">${tr>0?"+":""}${tr.toFixed(1)}%</span>`;
            document.getElementById('pf-total-profit').innerHTML=`<span class="${tc}">${tp>0?"+":""}${tp.toLocaleString()}ì›</span>`;
            document.getElementById('pf-total-div').innerText=td.toLocaleString()+"ì›";
            updateStockPieChart(chartLabels, chartData);
            const totalStockVal = Math.round(tv / 10000); 
            const seedStockInput = document.getElementById('seed-stock');
            if(seedStockInput) seedStockInput.value = totalStockVal;
            saveSeedData(); 
        }

        function updateStockPieChart(labels, data) {
            const ctx = document.getElementById('stockPieChart').getContext('2d');
            const colors = ['#3b82f6', '#ef4444', '#10b981', '#f59e0b', '#8b5cf6', '#ec4899', '#6366f1', '#14b8a6', '#f97316', '#84cc16'];
            if (stockPieChart) { stockPieChart.data.labels = labels; stockPieChart.data.datasets[0].data = data; stockPieChart.update(); } else { stockPieChart = new Chart(ctx, { type: 'doughnut', data: { labels: labels, datasets: [{ data: data, backgroundColor: colors, borderWidth: 0, hoverOffset: 4 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right', labels: { boxWidth: 10, font: { size: 10 } } } } } }); }
        }

        function savePortfolio(){ localStorage.setItem('project2026_portfolio_v18_1',JSON.stringify(portfolioData)); }
    </script>
</body>
</html>
